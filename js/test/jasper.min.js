function X2JS(t){"use strict";function e(){void 0===t.escapeMode&&(t.escapeMode=!0),t.attributePrefix=t.attributePrefix||"_",t.arrayAccessForm=t.arrayAccessForm||"none",t.emptyNodeForm=t.emptyNodeForm||"text",void 0===t.enableToStringFunc&&(t.enableToStringFunc=!0),t.arrayAccessFormPaths=t.arrayAccessFormPaths||[],void 0===t.skipEmptyTextNodesForObj&&(t.skipEmptyTextNodesForObj=!0),void 0===t.stripWhitespaces&&(t.stripWhitespaces=!0),t.datetimeAccessFormPaths=t.datetimeAccessFormPaths||[]}function n(){function t(t){var e=String(t);return 1===e.length&&(e="0"+e),e}"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),"function"!=typeof Date.prototype.toISOString&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"})}function r(t){var e=t.localName;return null==e&&(e=t.baseName),null!=e&&""!=e||(e=t.nodeName),e}function i(t){return t.prefix}function a(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):t}function o(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function u(e,n,r){switch(t.arrayAccessForm){case"property":e[n]instanceof Array?e[n+"_asArray"]=e[n]:e[n+"_asArray"]=[e[n]]}if(!(e[n]instanceof Array)&&t.arrayAccessFormPaths.length>0){for(var i=0;i<t.arrayAccessFormPaths.length;i++){var a=t.arrayAccessFormPaths[i];if("string"==typeof a){if(a==r)break}else if(a instanceof RegExp){if(a.test(r))break}else if("function"==typeof a&&a(e,n,r))break}i!=t.arrayAccessFormPaths.length&&(e[n]=[e[n]])}}function c(t){var e=t.split(/[-T:+Z]/g),n=new Date(e[0],e[1]-1,e[2]),r=e[5].split(".");if(n.setHours(e[3],e[4],r[0]),r.length>1&&n.setMilliseconds(r[1]),e[6]&&e[7]){var i=60*e[6]+Number(e[7]),a=/\d\d-\d\d:\d\d$/.test(t)?"-":"+";i=0+("-"==a?-1*i:i),n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else-1!==t.indexOf("Z",t.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function s(e,n,r){if(t.datetimeAccessFormPaths.length>0){for(var i=r.split(".#")[0],a=0;a<t.datetimeAccessFormPaths.length;a++){var o=t.datetimeAccessFormPaths[a];if("string"==typeof o){if(o==i)break}else if(o instanceof RegExp){if(o.test(i))break}else if("function"==typeof o&&o(obj,n,i))break}return a!=t.datetimeAccessFormPaths.length?c(e):e}return e}function l(e,n){if(e.nodeType==b.DOCUMENT_NODE){for(var a=new Object,c=e.childNodes,f=0;f<c.length;f++){var d=c.item(f);if(d.nodeType==b.ELEMENT_NODE){var p=r(d);a[p]=l(d,p)}}return a}if(e.nodeType==b.ELEMENT_NODE){var a=new Object;a.__cnt=0;for(var c=e.childNodes,f=0;f<c.length;f++){var d=c.item(f),p=r(d);d.nodeType!=b.COMMENT_NODE&&(a.__cnt++,null==a[p]?(a[p]=l(d,n+"."+p),u(a,p,n+"."+p)):(null!=a[p]&&(a[p]instanceof Array||(a[p]=[a[p]],u(a,p,n+"."+p))),a[p][a[p].length]=l(d,n+"."+p)))}for(var h=0;h<e.attributes.length;h++){var v=e.attributes.item(h);a.__cnt++,a[t.attributePrefix+v.name]=v.value}var m=i(e);return null!=m&&""!=m&&(a.__cnt++,a.__prefix=m),null!=a["#text"]&&(a.__text=a["#text"],a.__text instanceof Array&&(a.__text=a.__text.join("\n")),t.escapeMode&&(a.__text=o(a.__text)),t.stripWhitespaces&&(a.__text=a.__text.trim()),delete a["#text"],"property"==t.arrayAccessForm&&delete a["#text_asArray"],a.__text=s(a.__text,p,n+"."+p)),null!=a["#cdata-section"]&&(a.__cdata=a["#cdata-section"],delete a["#cdata-section"],"property"==t.arrayAccessForm&&delete a["#cdata-section_asArray"]),1==a.__cnt&&null!=a.__text?a=a.__text:0==a.__cnt&&"text"==t.emptyNodeForm?a="":a.__cnt>1&&null!=a.__text&&t.skipEmptyTextNodesForObj&&(t.stripWhitespaces&&""==a.__text||""==a.__text.trim())&&delete a.__text,delete a.__cnt,!t.enableToStringFunc||null==a.__text&&null==a.__cdata||(a.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),a}return e.nodeType==b.TEXT_NODE||e.nodeType==b.CDATA_SECTION_NODE?e.nodeValue:void 0}function f(e,n,r,i){var o="<"+(null!=e&&null!=e.__prefix?e.__prefix+":":"")+n;if(null!=r)for(var u=0;u<r.length;u++){var c=r[u],s=e[c];t.escapeMode&&(s=a(s)),o+=" "+c.substr(t.attributePrefix.length)+"='"+s+"'"}return o+=i?"/>":">"}function d(t,e){return"</"+(null!=t.__prefix?t.__prefix+":":"")+e+">"}function p(t,e){return-1!==t.indexOf(e,t.length-e.length)}function h(e,n){return!!("property"==t.arrayAccessForm&&p(n.toString(),"_asArray")||0==n.toString().indexOf(t.attributePrefix)||0==n.toString().indexOf("__")||e[n]instanceof Function)}function v(t){var e=0;if(t instanceof Object)for(var n in t)h(t,n)||e++;return e}function m(e){var n=[];if(e instanceof Object)for(var r in e)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(t.attributePrefix)&&n.push(r);return n}function y(e){var n="";return null!=e.__cdata&&(n+="<![CDATA["+e.__cdata+"]]>"),null!=e.__text&&(n+=t.escapeMode?a(e.__text):e.__text),n}function g(e){var n="";return e instanceof Object?n+=y(e):null!=e&&(n+=t.escapeMode?a(e):e),n}function _(t,e,n){var r="";if(0==t.length)r+=f(t,e,n,!0);else for(var i=0;i<t.length;i++)r+=f(t[i],e,m(t[i]),!1),r+=x(t[i]),r+=d(t[i],e);return r}function x(t){var e="",n=v(t);if(n>0)for(var r in t)if(!h(t,r)){var i=t[r],a=m(i);if(null==i||void 0==i)e+=f(i,r,a,!0);else if(i instanceof Object)if(i instanceof Array)e+=_(i,r,a);else if(i instanceof Date)e+=f(i,r,a,!1),e+=i.toISOString(),e+=d(i,r);else{var o=v(i);o>0||null!=i.__text||null!=i.__cdata?(e+=f(i,r,a,!1),e+=x(i),e+=d(i,r)):e+=f(i,r,a,!0)}else e+=f(i,r,a,!1),e+=g(i),e+=d(i,r)}return e+=g(t)}var w="1.1.5";t=t||{},e(),n();var b={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(t){var e=window.ActiveXObject||"ActiveXObject"in window;if(void 0===t)return null;var n;if(window.DOMParser){var r=new window.DOMParser,i=null;if(!e)try{i=r.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch(a){i=null}try{n=r.parseFromString(t,"text/xml"),null!=i&&n.getElementsByTagNameNS(i,"parsererror").length>0&&(n=null)}catch(a){n=null}}else 0==t.indexOf("<?")&&(t=t.substr(t.indexOf("?>")+2)),n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t);return n},this.asArray=function(t){return t instanceof Array?t:[t]},this.toXmlDateTime=function(t){return t instanceof Date?t.toISOString():"number"==typeof t?new Date(t).toISOString():null},this.asDateTime=function(t){return"string"==typeof t?c(t):t},this.xml2json=function(t){return l(t)},this.xml_str2json=function(t){var e=this.parseXmlString(t);return null!=e?this.xml2json(e):null},this.json2xml_str=function(t){return x(t)},this.json2xml=function(t){var e=this.json2xml_str(t);return this.parseXmlString(e)},this.getVersion=function(){return w}}var jas={};!function(t){function e(t,e){function n(){l=l||0,t=t||0,f=!0,c=Date.now()}function r(){return t}function i(){s=!0}function a(n){t=e?Math.random()*n:n}function o(n,r){if(!s){var i=Date.now();return i-c>=t?(e&&a(l),"function"==typeof n?(c=i,n(i)):!0):"function"==typeof r?r(i-c):!1}}function u(){return Date.now()-c}var c,s,l=t||null,t=t||null,f=!!t,e=e||!1;return{start:n,stop:i,setTimer:a,checkTime:o,getInterval:r,getTime:u}}function n(){function t(t,e){r[t]=e}function e(t){return r[t]}function n(t,e){return r[t]==e}var r={};return{setState:t,getState:e,checkStatus:n}}function r(){function t(t,e){return"function"==typeof n[t]?n[t](e):!1}function e(t,e){"function"==typeof e&&(n[t]=e)}var n={constant:function(t){return function(e){return t}},linear:function(t,e){return function(n){return t*n+e}},exponential:function(t){return function(e){return e*e+t}},quadratic:function(t,e,n){return function(r){return t*r*r+e*r+n}},logarithmic:function(t){return function(t){}}};return{inst:t,newClass:e}}var i=r();t.Util={timer:e,finiteStateMachine:n,Graph:i}}(jas),function(t){function e(){function t(t){return{callback:t}}var e={};return{publish:function(t){for(var n in e)e[n].callback(t)},addSubscriber:function(n,r){e[n]=t(r)},removeSubscriber:function(t){e[t]=void 0,delete e[t]}}}var n={},r=0;t.Event={addPublication:function(t){n[t]=e()},remPublication:function(t){n[t]=void 0,delete n[t]},subscribe:function(t,e,i){var a;return arguments.length>2?(a=e,n[t].addSubscriber(a,i)):"function"==typeof e&&(a=e.name?e.name:"sub-"+r++,i=e,n[t].addSubscriber(a,i)),console.log(a),{unsubscribe:function(){console.log(a),n[t].removeSubscriber(a)},resubscribe:function(){n[t].addSubscriber(i.name,i)}}},unsubscribe:function(t,e){n[t].removeSubscriber(e)},publish:function(t,e){n[t].publish(e)}}}(jas),function(t){function e(t,e,n){var r={},i=new XMLHttpRequest,a={};i.onreadystatechange=function(){var e=2==i.readyState;e&&(u.maps[t]=!1)},i.onload=function(){if(200==i.status){var e=new X2JS;a=e.xml_str2json(i.responseText).map,r.tileX=Number(a._height),r.tileY=Number(a._width),r.tileW=Number(a._tilewidth),r.tileH=Number(a._tileheight),r.x=0,r.y=0,r.w=r.tileX*r.tileW,r.h=r.tileX*r.tileH,r.layers={};for(var o in a.layer){var c={};c.name=a.layer[o]._name,c.width=a.layer[o]._width,c.height=a.layer[o]._height,c.entities=[];for(var s in a.layer[o].data.tile){var l={};l.tileId=Number(a.layer[o].data.tile[s]._gid),0!=l.tileId&&(l.tileId--,l.x=s*r.tileW%r.w,l.y=Math.floor(s*r.tileW/r.w)*r.tileH,c.entities.push(l))}c.properties={};for(var f in a.layer[o].properties){var d=a.layer[o].properties[f];c.properties[d._name]=d._value}r.layers[c.name]=c}}"function"==typeof n&&n(r),u.maps[t]=r},i.onerror=function(){console.error("error finding tmx file in newMap")},i.open("get",e,!0),i.send()}function n(t,e,n){var r=new Image;u.images[t]=!1,r.onload=function(){u.images[t]=r,"function"==typeof n&&n(r)},r.onerror=function(t){console.log(t)},r.src=e}function r(t){return u.images[t]||!1}function i(t,e){}function a(t){return u.audio[t]||!1}function o(){for(var t in u){var e=u[t];for(var n in e){e[n];if(!n)return!1}}return!0}var u={images:{},audio:{},maps:{}};t.Asset={newImage:n,audio:i,getImage:r,getAudio:a,getMapData:e,assetsReady:o}}(jas),function(t){function e(t,e){h[e]=t}function n(t,e){var n=p[t]?p[t](e):{};return n}function r(t,e){p[t]=e}function i(t,e){var n=t.id;return e&&(f[e]=f[e]||{},f[e][n]=n),l[n]=t,t}function a(t){for(var e in f)delete f[e][t.id];delete l[t.id]}function o(t){for(var e in f)delete f[e][t];delete l[t]}function u(t,e){if(f[t]){var n=l[Object.keys(f[t]).sort()[0]];if(n&&"function"==typeof e)return e(n),n}}function c(t,e){var n=[];for(var r in f[t]){var i=f[t][r];n.push(l[i])}return"function"==typeof e&&n.forEach(e),n}function s(t,e){return c(t)[0]}var l={},f={},d=0,p={entity:function(e){var n={};e=e||{};var r,i=t.Util.finiteStateMachine();return n.setState=function(t,e){i.setState(t,e)},n.getState=function(t){return i.getState(t)},n.checkStatus=function(t,e,n,r){return i.checkStatus(t,e)?("function"==typeof n&&n(),!0):("function"==typeof r&&r(),!1)},n.setController=function(t){r=t||!1},n.id=d,d++,n.x=e.x||0,n.y=e.y||0,n.w=e.w||0,n.h=e.h||0,n},rect:function(t){var e=this.entity(t),n=t.color||null,r=null!=t.alpha?t.alpha:null;return e.getOrigin=function(){return{x:e.x,y:e.y}},e.getCenter=function(){var t=e.x+e.w/2,n=e.y+e.h/2;return{x:t,y:n}},e.getArea=function(){return e.w*e.h},e.getRandomVector=function(t,n,r,i){r=r||0,i=i||0;var a=Math.random()*(e.w+r)+e.x+t,o=Math.random()*(e.h+i)+e.y+n;return{x:a,y:o}},e.isColliding=function(t,n,r){if(e.getState("collideable")&&t.getState("collideable")){var i=this.x+this.w>t.x,a=this.y+this.h>t.y,o=t.x+t.w>this.x,u=t.y+t.h>this.y;return i&&a&&o&&u?("function"==typeof n?n():null,!0):("function"==typeof r?r():null,!1)}},e.contains=function(t,n,r){var i=t.x>e.x,a=t.x<e.x+e.w,o=t.y>e.y,u=verctor.y<e.y+e.h;return i&&a&&o&&u?("function"==typeof n?n():null,!0):("function"==typeof r?r():null,!1)},e.getDraw=function(){return{type:"rect",x:this.x,y:this.y,w:this.w,h:this.h,color:n,alpha:r}},e},circ:function(t){var e=this.entity(t),n=Math.pi*Math.pow(e.w/2,2);return e.getDraw=function(){return{type:"circ",x:this.x,y:this.y,w:this.w,h:this.h,color:color,alpha:alpha}},e.getArea=function(){return n},e.getCenter=function(){var t=e.x+e.w/2,n=e.y+e.h/2;return{x:t,y:n}},e},shape:function(t){var e=p[t.shape]?p[t.shape](t):p.rect(t);e.shape=t.shape;var n=t.collideable?t.collideable:!0;return e.setState("collideable",n),e},composite:function(t){var e=p.shape(t),n={};return e.getLayer=function(t,e){var r=n[t];if("function"!=typeof e||!r)return r;for(var i=0;i<r.length;i++)e(r[i])},e.addLayers=function(t){for(var n in t)e.addLayer(n,t[n])},e.addLayer=function(t,e){var r=e||[];n[t]=r},e.pushToLayer=function(t,e){var r=n[t];r.push(e)},e.orderLayers=function(){},e.getDraw=function(){return{type:"complex",layers:e.layers}},e},component:function(t){var e=p.composite(t);return e},widget:function(t){t.shape=t.shape||"rect";var e=p.component(t),n=t.padding||5,r=[];return e.addRow=function(t){function e(){var t=[];return t.w=0,t.h=0,t.addEntity=function(e){t.push(e.id)},t.getEntityDimensions=function(e){var n={},r=l[t[e]];return n.w=r.w,n.h=r.h,n},t}var n=e();r.push(n),"function"==typeof t&&t(n)},e.pack=function(){function t(){var t=0,i=0;for(var a in r){var o=r[a];o.w=0,o.h=0,o.col=0;for(var u in o){o.col++;var c=o[u];o.w+=c.w,o.h=c.h>o.h?c.h:o.h}o.h+=(a+1)*n,o.w+=(o.col+1)*n,t=o.w>t?o.w:t,i+=o.h}e.w=t,e.h=i}function i(){var t=e.y+n;for(var i in r){var a=r[i],o=e.x+n;for(var u in a){var c=0,s=a.col/e.w,l=a[u];entites[l].x=o,entites[l].y=t,o=s*c+n}t+=a.h+n}}t(),i()},e},text:function(e){function n(){var e=document.createElement("canvas");e.width=50,e.height=50;var n=e.getContext("2d"),c=n.measureText(o);e.width=c.width,e.height=50,n.font=a,n.fillStyle=r,n.globalAlpha=i,n.fillText(o,0,10);var s=e.toDataURL();t.Asset.newImage("text-image:"+u.id,s,function(t){document.appendChild(t);var n={type:"sprite",frame:{sx:0,sy:0,sw:e.width,sh:e.height,x:u.x,y:u.y,w:e.width,h:e.height},imageId:s};u.getDraw=function(){return n}})}e=e||{};var r=e.color||"#fff",i=e.color||1,a=e.font||"1em arial",o=e.string,u=p.sprite(e);return u.changeText=function(t){"function"==typeof t&&(o=t(o)),n()},u.getDraw=function(){return{type:"text",x:u.x,y:u.y,string:o,color:r,alpha:i,font:a}},n(),u},label:function(t){t=t||{};var e=p.component(t),n=(t.text||{},t.x),r=t.y,i=t.w,a=t.h,o=p.text({string:t.string,x:n,y:r+a,w:i,h:a,color:t.textColor,alpha:t.textAlpha}),u=t.shape||{},c=(u.type||"rect",p.rect({x:n,y:r,w:i,h:a,color:t.shapeColor,alpha:t.shapeAlpha}));return e.addLayers({text:[o],container:[c]}),e.changeLabelText=function(t){e.getLayer("text")[0].changeText(t)},e},sprite:function(e){function n(e){function n(t,e,n,r){return{sx:t,sy:e,sw:n,sh:r}}e=e?e:{};var i={};i.name=e.name;for(var o=e.start,u=e.stop,c=r.w,s=r.h,l=e.looping?e.looping:!1,f=(e.pingpong?e.pingpong:!1,e.fps?e.fps:12),d=[],p=o;u>p;p++){var h=p*c%a,v=Math.floor(p*c/a)*s;d.push(n(h,v,c,s))}var m=e.defaultFrame||d.length-1;i.onend=e.onend;var y=0,g=!1,_=t.Util.timer(1e3/f,!1);return _.start(),i.update=function(){g||_.checkTime(function(){var t=++y>=d.length;t&&l?y=0:t&&(y=m||d.length-1,"function"==typeof i.onend&&i.onend(),g=!0)})},i.getCurrentFrame=function(){return d[y]},i.reset=function(){y=0,g=!1},e.def&&(r.anim=i),i}var r=this.composite(e),i=e?e.imageId:null,a=t.Asset.getImage(i).width;t.Asset.getImage(i).height;r.animations={},e.animations=e.animations||[{name:"still",start:0,stop:1,def:!0}];for(var o in e.animations){var u=e.animations[o];r.animations[u.name]=n(u)}return r.setAnim=function(t){r.anim=r.animations[t]},r.getAnimId=function(){return r.anim.name},r.addAnim=function(t,e){r.animations[t]=n(e),e.def&&(r.anim=r.animations[t])},r.updateAnim=function(){r.anim.update()},r.resetAnim=function(t){t?r.animation[t].reset():r.anim.reset()},r.getDraw=function(){var t=r.anim.getCurrentFrame();return{type:"sprite",frame:t,x:this.x,y:this.y,w:this.w,h:this.h,imageId:i}},r},spawnZone:function(e){function n(){return"random"==s?function(){return r.getRandomVector(0,0,-o.w,-o.h)}:"center"==s?function(){return r.getCenter()}:function(){return r.getOrigin()}}var e=e||{};e.alpha=e.alpha||.4;var r=this.shape(e),i=e.intervalFixed!==!1,a=e.spawnType,o=e.spawnMutator||{},u=e.spawnRate||3e3,c=0,s=e.spawnPosition||"origin",l=e.spawnGroup||null,f=e.spawnMax||10,d={},p=t.Util.timer(u,i);p.start(),r.configureSpawn=function(t,e){a=t,o=e};var h=n(e.spawnPosition)||null;return r.setSpawnPosition=function(t){s=t,h=n()},r.spawn=function(){f>c&&p.checkTime(function(){var e=h();o.x=e.x,o.y=e.y;var n=t.Entity.inst(a,o);d[n.id]=n.id,t.Entity.addEntity(n,l),c++})},r.removeSpawn=function(e){delete d[e.id],t.Entity.removeEntityById(e.id),c--},r.removeSpawnById=function(e){delete d[e],t.Entity.removeEntityById(e),c--},r},tile:function(t){var t=t?t:{},e=this.sprite(t);return e.setAnim("tile"),e.tileId=t.tileId,e},map:function(t){t=t?t:{};var e=this.composite(t),n={},r=t.tileW,i=t.tileH,a=t.imageId;return e.configureTile=function(t,e){n[t]=e},e.makeTiles=function(){for(var o in t.layers){var u=[];for(var c in t.layers[o].entities){var s=t.layers[o].entities[c];n[s.tileId]?n[s.tileId]:function(t){return t};s.imageId=a,s.w=r,s.h=i,s.animations=[{name:"tile",start:s.tileId,stop:s.tileId+1,def:!0}];var l=p.tile(s);u.push(l)}e.addLayer(t.layers[o].name,u)}},e}},h={};t.Entity={inst:n,newClass:r,addEntity:i,removeEntity:a,removeEntityById:o,enumerateEntity:e,getFirst:u,getGroup:c,getMap:s}}(jas),function(t){function n(n){function r(e){var n=c[e.keyCode];o[e.keyCode]||t.Event.publish(n+"_IS_PRESSED"),o[e.keyCode]=!0}function i(e){delete o[e.keyCode];var n=c[e.keyCode];t.Event.publish(n+"_IS_UP")}function a(e){var n=o[u[e]];return n&&t.Event.publish(c[u[e]]+"_IS_DOWN"),!!n}l={},t.Event.addPublication("MOUSE_IS_PRESSED"),t.Event.addPublication("MOUSE_IS_DOWN"),t.Event.addPublication("MOUSE_IS_UP"),n.addEventListener("mousedown",function(e){l.mouseup&&(delete l.mouseup,t.Event.publish("MOUSE_IS_PRESSED",e)),l.mousedown=!0,t.Event.publish("MOUSE_IS_DOWN",e)},!1),n.addEventListener("mouseup",function(){l.mousedown&&(delete l.mousedown,t.Event.publish("MOUSE_IS_UP",e)),l.mouseup=!0,window.setTimeout(function(){delete l.mouseup},10)},!1);var o={},u={UP:38,RIGHT:39,DOWN:40,LEFT:37,SPACE:32,ENTER:13,A:65,S:83,D:68,W:87,CTRL:17,SHIFT:16,ALT:18},c={};for(var s in u)c[u[s]]=s,t.Event.addPublication(s+"_IS_PRESSED"),t.Event.addPublication(s+"_IS_DOWN"),t.Event.addPublication(s+"_IS_UP");window.addEventListener("keydown",r,!1),window.addEventListener("keyup",i,!1);var l={isKeyDown:a,areKeysDown:function(t){for(var e in t){var n=t[e];a(n)}},areAllKeysDown:function(t,e){for(var n in t){var r=t[n];if(!a(r))return!1}return"function"==typeof e?e():null,!0},keysNotPressed:function(t){for(var e in t){var n=t[e];if(a(n))return!1}return"function"==typeof callback?callback():null,!0}};return l}function r(t,e){return o[t](e)}function i(t,e){return"function"!=typeof e?!1:void(o[t]=e)}var a=0,o={controller:function(e){function n(){for(var n in e){var r=t.Event.subscribe(n,e[n]);subscriptions["jas-controller-"+a]=r}}e=e||{};var r={};return subscriptions={},r.id=a++,n(),r.kill=function(){for(var t in subscriptions){var e=subscriptions[t];e.unsubscribe()}},r.revive=function(){for(var t in subscriptions){var e=subscriptions[t];e.resubscribe()}},r}};t.controllerFactory=n,t.Controller={inst:r,newClass:i}}(jas),function(t){function e(e,n){function r(t){var e=t.color||"#000";n.fillStyle=e,n.globalAlpha=null!=t.alpha?t.alpha:1;var r=t.x,i=t.y,a=t.w,o=t.h;n.fillRect(r,i,a,o),n.globalAlpha=1}function i(t){var e=t.color||"#000";n.fillStyle=e,n.globalAlpha=t.alpha||1;var r=t.x+t.w/2,i=t.y+t.h/2;n.beginPath(),n.arc(r,i,50,0,2*Math.PI),n.fill()}function a(t){var e=t.x,r=t.y,i=t.string;n.globalAlpha=t.alpha||1,n.fillStyle=t.color||"#fff",n.font=t.font||"1em arial",n.fillText(i,e,r),n.globalAlpha=1}function o(e){var r=t.Asset.getImage(e.imageId),i=e.frame,a=i.sx,o=i.sy,u=i.sw,c=i.sh,s=e.x,l=e.y,f=e.w,d=e.h;r&&n.drawImage(r,a,o,u,c,s,l,f,d)}function u(t){for(var e in t.layers){var n=t.layers[e];l(n)}}function c(e){var n=t.Entity.getGroup(e);l(n)}function s(e,n){t.Entity.getGroup(e,function(t){l(t.getLayer(n))})}function l(t){for(var e in t){var n=t[e],r=n.getDraw?n.getDraw():!1;r&&f(r)}}function f(t){switch(t.type){case"rect":r(t);break;case"circ":i(t);break;case"sprite":o(t);break;case"text":a(t);break;case"complex":u(t)}}function d(t,r){n.fillStyle=t?t:"#f0f",n.globalAlpha=r?r:1,n.fillRect(0,0,e.width,e.height)}function p(n,r){var i=e.toDataURL();t.Asset.newImage(n,i,r)}function h(){return{w:e.width,h:e.height}}return t.Graphics={getScreenImage:p,getScreenDimensions:h},{renderGroup:c,renderGroupLayer:s,fillScreen:d}}t.graphicsFactory=e}(jas),function(t){function e(t,e,n,r){o[t]={stateName:t,init:e,update:n,render:r},null==u&&(u=o[t])}function n(t,e,n){u.update(t,e),u.render(n)}function r(t){u=o[t]}function i(){0==Object.keys(o).length&&initError("You must inject at least one game state using jas.addState\n");for(var t in o)o[t].init()}function a(t){o[t].init()}var o={},u=null;t.State={addState:e,changeState:r,initAllStates:i,initState:a,updateState:n}}(jas),function(t){function e(e,n,r,l){var f=document.getElementById(e);i=document.createElement("canvas"),i.width=n||320,i.height=r||320,i.innerHTML="<h3>Your browser doesn't support HTML5 canvas!</h3>",i.innerHTML+="<p>Try one of these browsers...</p>",a=i.getContext("2d"),o=t.controllerFactory(i),u=t.graphicsFactory(i,a),f.appendChild(i),t.State.initAllStates(),c=1e3/l||1e3/60,s=t.Util.timer(c,!1)}function n(){s.start(),r()}function r(){f(r),s.checkTime(function(e){t.State.updateState(e,o,u)})}var i,a,o,u,c,s,l=window,f=l.requestAnimationFrame||l.mozRequestAnimationFrame||l.msRequestAnimationFrame||l.webkitRequestAnimationFrame||l.oRequestAnimationFrame;t.init=e,t.begin=n}(jas),function(t){function e(t,e){return"function"==typeof i[t]?i[t](e):!1}function n(t,e){"function"==typeof e&&(i[t]=e)}var r={UP:-1,RIGHT:1,DOWN:1,LEFT:-1},i={core:function(t){t=t||{};var e,n={};return n.bind=function(t){e=function(e,n){t[e]+=n},n.update=e},n},orthogonal:function(t){var e=0,n=0,a=i.core(t);return a.resetDirs=function(){e=0,n=0},a.resetDirX=function(){e=0},a.resetDirY=function(){n=0},a.up=function(t){n=r.UP,a.update("y",-t)},a.right=function(t){e=r.RIGHT,a.update("x",t)},a.down=function(t){n=r.DOWN,a.update("y",t)},a.left=function(t){e=r.LEFT,a.update("x",-t)},a.collide=function(t){n==r.UP?a.update("y",t):n==r.DOWN&&a.update("y",-t),e==r.RIGHT?a.update("x",-t):e==r.LEFT&&a.update("x",t)},a},radial:function(t){var e=i.core(t);e.move=function(t,e){}},platformer:function(t){t=t||{};var e=i.core();return e.left=function(){e.update("x",-val)},e.right=function(){e.update("x",val)},e.collide=function(){},e.jump=function(t,e){},e.gravity=function(t){e.update("y",t)},e}};t.Physics={inst:e,newClass:n}}(jas);