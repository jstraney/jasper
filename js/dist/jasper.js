function X2JS(t){function e(){void 0===t.escapeMode&&(t.escapeMode=!0),t.attributePrefix=t.attributePrefix||"_",t.arrayAccessForm=t.arrayAccessForm||"none",t.emptyNodeForm=t.emptyNodeForm||"text",void 0===t.enableToStringFunc&&(t.enableToStringFunc=!0),t.arrayAccessFormPaths=t.arrayAccessFormPaths||[],void 0===t.skipEmptyTextNodesForObj&&(t.skipEmptyTextNodesForObj=!0),void 0===t.stripWhitespaces&&(t.stripWhitespaces=!0),t.datetimeAccessFormPaths=t.datetimeAccessFormPaths||[]}function n(){function t(t){var e=String(t);return 1===e.length&&(e="0"+e),e}"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|^\n+|(\s|\n)+$/g,"")}),"function"!=typeof Date.prototype.toISOString&&(Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"})}function r(t){var e=t.localName;return null==e&&(e=t.baseName),null!=e&&""!=e||(e=t.nodeName),e}function i(t){return t.prefix}function a(t){return"string"==typeof t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):t}function o(t){return t.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function s(e,n,r){switch(t.arrayAccessForm){case"property":e[n]instanceof Array?e[n+"_asArray"]=e[n]:e[n+"_asArray"]=[e[n]]}if(!(e[n]instanceof Array)&&t.arrayAccessFormPaths.length>0){for(var i=0;i<t.arrayAccessFormPaths.length;i++){var a=t.arrayAccessFormPaths[i];if("string"==typeof a){if(a==r)break}else if(a instanceof RegExp){if(a.test(r))break}else if("function"==typeof a&&a(e,n,r))break}i!=t.arrayAccessFormPaths.length&&(e[n]=[e[n]])}}function u(t){var e=t.split(/[-T:+Z]/g),n=new Date(e[0],e[1]-1,e[2]),r=e[5].split(".");if(n.setHours(e[3],e[4],r[0]),r.length>1&&n.setMilliseconds(r[1]),e[6]&&e[7]){var i=60*e[6]+Number(e[7]),a=/\d\d-\d\d:\d\d$/.test(t)?"-":"+";i=0+("-"==a?-1*i:i),n.setMinutes(n.getMinutes()-i-n.getTimezoneOffset())}else-1!==t.indexOf("Z",t.length-1)&&(n=new Date(Date.UTC(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds())));return n}function l(e,n,r){if(t.datetimeAccessFormPaths.length>0){for(var i=r.split(".#")[0],a=0;a<t.datetimeAccessFormPaths.length;a++){var o=t.datetimeAccessFormPaths[a];if("string"==typeof o){if(o==i)break}else if(o instanceof RegExp){if(o.test(i))break}else if("function"==typeof o&&o(obj,n,i))break}return a!=t.datetimeAccessFormPaths.length?u(e):e}return e}function c(e,n){if(e.nodeType==T.DOCUMENT_NODE){for(var a=new Object,u=e.childNodes,f=0;f<u.length;f++){var d=u.item(f);if(d.nodeType==T.ELEMENT_NODE){var h=r(d);a[h]=c(d,h)}}return a}if(e.nodeType==T.ELEMENT_NODE){var a=new Object;a.__cnt=0;for(var u=e.childNodes,f=0;f<u.length;f++){var d=u.item(f),h=r(d);d.nodeType!=T.COMMENT_NODE&&(a.__cnt++,null==a[h]?(a[h]=c(d,n+"."+h),s(a,h,n+"."+h)):(null!=a[h]&&(a[h]instanceof Array||(a[h]=[a[h]],s(a,h,n+"."+h))),a[h][a[h].length]=c(d,n+"."+h)))}for(var m=0;m<e.attributes.length;m++){var p=e.attributes.item(m);a.__cnt++,a[t.attributePrefix+p.name]=p.value}var g=i(e);return null!=g&&""!=g&&(a.__cnt++,a.__prefix=g),null!=a["#text"]&&(a.__text=a["#text"],a.__text instanceof Array&&(a.__text=a.__text.join("\n")),t.escapeMode&&(a.__text=o(a.__text)),t.stripWhitespaces&&(a.__text=a.__text.trim()),delete a["#text"],"property"==t.arrayAccessForm&&delete a["#text_asArray"],a.__text=l(a.__text,h,n+"."+h)),null!=a["#cdata-section"]&&(a.__cdata=a["#cdata-section"],delete a["#cdata-section"],"property"==t.arrayAccessForm&&delete a["#cdata-section_asArray"]),1==a.__cnt&&null!=a.__text?a=a.__text:0==a.__cnt&&"text"==t.emptyNodeForm?a="":a.__cnt>1&&null!=a.__text&&t.skipEmptyTextNodesForObj&&(t.stripWhitespaces&&""==a.__text||""==a.__text.trim())&&delete a.__text,delete a.__cnt,!t.enableToStringFunc||null==a.__text&&null==a.__cdata||(a.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),a}return e.nodeType==T.TEXT_NODE||e.nodeType==T.CDATA_SECTION_NODE?e.nodeValue:void 0}function f(e,n,r,i){var o="<"+(null!=e&&null!=e.__prefix?e.__prefix+":":"")+n;if(null!=r)for(var s=0;s<r.length;s++){var u=r[s],l=e[u];t.escapeMode&&(l=a(l)),o+=" "+u.substr(t.attributePrefix.length)+"='"+l+"'"}return o+=i?"/>":">"}function d(t,e){return"</"+(null!=t.__prefix?t.__prefix+":":"")+e+">"}function h(t,e){return-1!==t.indexOf(e,t.length-e.length)}function m(e,n){return!!("property"==t.arrayAccessForm&&h(n.toString(),"_asArray")||0==n.toString().indexOf(t.attributePrefix)||0==n.toString().indexOf("__")||e[n]instanceof Function)}function p(t){var e=0;if(t instanceof Object)for(var n in t)m(t,n)||e++;return e}function g(e){var n=[];if(e instanceof Object)for(var r in e)-1==r.toString().indexOf("__")&&0==r.toString().indexOf(t.attributePrefix)&&n.push(r);return n}function y(e){var n="";return null!=e.__cdata&&(n+="<![CDATA["+e.__cdata+"]]>"),null!=e.__text&&(n+=t.escapeMode?a(e.__text):e.__text),n}function v(e){var n="";return e instanceof Object?n+=y(e):null!=e&&(n+=t.escapeMode?a(e):e),n}function _(t,e,n){var r="";if(0==t.length)r+=f(t,e,n,!0);else for(var i=0;i<t.length;i++)r+=f(t[i],e,g(t[i]),!1),r+=x(t[i]),r+=d(t[i],e);return r}function x(t){var e="",n=p(t);if(n>0)for(var r in t)if(!m(t,r)){var i=t[r],a=g(i);if(null==i||void 0==i)e+=f(i,r,a,!0);else if(i instanceof Object)if(i instanceof Array)e+=_(i,r,a);else if(i instanceof Date)e+=f(i,r,a,!1),e+=i.toISOString(),e+=d(i,r);else{var o=p(i);o>0||null!=i.__text||null!=i.__cdata?(e+=f(i,r,a,!1),e+=x(i),e+=d(i,r)):e+=f(i,r,a,!0)}else e+=f(i,r,a,!1),e+=v(i),e+=d(i,r)}return e+=v(t)}var w="1.1.5";t=t||{},e(),n();var T={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(t){var e=window.ActiveXObject||"ActiveXObject"in window;if(void 0===t)return null;var n;if(window.DOMParser){var r=new window.DOMParser,i=null;if(!e)try{i=r.parseFromString("INVALID","text/xml").childNodes[0].namespaceURI}catch(a){i=null}try{n=r.parseFromString(t,"text/xml"),null!=i&&n.getElementsByTagNameNS(i,"parsererror").length>0&&(n=null)}catch(a){n=null}}else 0==t.indexOf("<?")&&(t=t.substr(t.indexOf("?>")+2)),n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t);return n},this.asArray=function(t){return t instanceof Array?t:[t]},this.toXmlDateTime=function(t){return t instanceof Date?t.toISOString():"number"==typeof t?new Date(t).toISOString():null},this.asDateTime=function(t){return"string"==typeof t?u(t):t},this.xml2json=function(t){return c(t)},this.xml_str2json=function(t){var e=this.parseXmlString(t);return null!=e?this.xml2json(e):null},this.json2xml_str=function(t){return x(t)},this.json2xml=function(t){var e=this.json2xml_str(t);return this.parseXmlString(e)},this.getVersion=function(){return w}}function jasFactory(){function t(t,e,n){function r(t){console.error(t)}function i(){function t(t){n[t.keyCode]=!0}function e(t){delete n[t.keyCode]}h.addEventListener("mousedown",function(){p.mouseup&&delete p.mouseup,p.mousedown=!0},!1),h.addEventListener("mouseup",function(){p.mousedown&&delete p.mousedown,p.mouseup=!0,window.setTimeout(function(){delete p.mouseup},10)},!1);var n={},r={UP:38,RIGHT:39,DOWN:40,LEFT:37,SPACE:32,ENTER:13,A:65,S:83,D:68,W:87,CTRL:17,SHIFT:16,ALT:18};window.addEventListener("keydown",t,!1),window.addEventListener("keyup",e,!1);var i={isKeyDown:function(t){var e=n[r[t]];return!!e},areKeysDown:function(t){for(var e in t){var n=t[e];if(!this.isKeyDown(n))return!1}return!0},keysNotPressed:function(t){for(var e in t){var n=t[e];if(this.isKeyDown(n))return!1}return!0}};return i}function a(){function t(t){}function e(t,e){n[t]=n[t]?n[t]:[],n[t].push(e)}var n={},r={publish:t,subscribe:e};return r}var o=document.getElementById(t);h=document.createElement("canvas"),h.width=e?e:320,h.height=n?n:320,h.innerHTML="<h3>Your browser doesn't support HTML5 canvas!</h3>",h.innerHTML+="<p>Try one of these browsers...</p>",m=h.getContext("2d"),o.appendChild(h),0==Object.keys(x).length&&r("You must inject at least one game state using jas.addState\n");for(var s in x)x[s].init();p=i(),_=a()}function e(){g=Date.now(),n()}function n(){var t=Date.now()-g;w.update(t,p),w.render(O),b(n)}function r(){function t(t,e,n){var r={};return new Promise(function(n,i){var o=new XMLHttpRequest,s={};o.onreadystatechange=function(){2==o.readyState&&(a.maps[t]=!1)},o.onload=function(){if(200==o.status){var t=new X2JS;s=t.xml_str2json(o.responseText).map,r.tileX=Number(s._height),r.tileY=Number(s._width),r.tileW=Number(s._tilewidth),r.tileH=Number(s._tileheight),r.x=0,r.y=0,r.w=r.tileX*r.tileW,r.h=r.tileX*r.tileH,r.layers={};for(var e in s.layer){var i={};i.name=s.layer[e]._name,i.width=s.layer[e]._width,i.height=s.layer[e]._height,i.tiles=[];for(var a in s.layer[e].data.tile){var u={};u.tileId=Number(s.layer[e].data.tile[a]._gid),0!=u.tileId&&(u.tileId--,u.x=a*r.tileW%r.w,u.y=Math.floor(a*r.tileW/r.w)*r.tileH,i.tiles.push(u))}i.properties={};for(var l in s.layer[e].properties){var c=s.layer[e].properties[l];i.properties[c._name]=c._value}r.layers[i.name]=i}}n(r)},o.onerror=function(){console.error("error finding tmx file in newMap")},o.open("get",e,!0),o.send()}).then(function(){"function"==typeof n&&n(r)})}function e(t,e,n){var r=new Image;return new Promise(function(n,i){a.images[t]=!1,r.onload=function(){a.images[t]=r,n(r)},r.src=e}).then(function(){"function"==typeof n&&n(r)})}function n(t){return a.images[t]?a.images[t]:!1}function r(t,e){}function i(t){return a.audio[t]?a.audio[t]:!1}var a={images:{},audio:{},maps:{}};return{newImage:e,audio:r,getImage:n,getAudio:i,getMapData:t}}function i(){function t(t,e){var r=n[t]?n[t](e):{};return r}function e(t,e){n[t]=e}var n={entity:function(t){var e={};return e.x=t.x,e.y=t.y,e.w=t.w,e.h=t.h,e},solid:function(t){var e=!0,n=this.entity(t);return n.setSolid=function(t){try{if("boolean"!=typeof t)throw"entity set solid requires boolean";e=t}catch(n){console.error(n.message)}},n.isCollideable=function(){return e},n.isColliding=function(t,e,n){if(this.isCollideable&&t.isCollideable){var r=this.x+this.w>t.x,i=this.y+this.h>t.y,a=t.x+t.w>this.x,o=t.y+t.h>this.y;r&&i&&a&&o?"function"==typeof e?e():null:"function"==typeof n?n():null}},n},rect:function(t){var e=this.solid(t),n=t.color?t.color:null;t.alpha?t.alpha:null;return e.getDraw=function(){return{type:"rect",x:this.x,y:this.y,w:this.w,h:this.h,color:n}},e},component:function(t){var t=t?t:{};this.rect(t)},sprite:function(t){function e(t){function e(t,e,n,r){return{sx:t,sy:e,sw:n,sh:r}}t=t?t:{};var r={};r.name=t.name;for(var i=t.start,a=t.stop,o=n.w,u=n.h,l=t.looping?t.looping:!1,c=(t.pingpong?t.pingpong:!1,t.fps?t.fps:12),f=[],d=i;a>d;d++){var h=d*o%s,m=Math.floor(d*o/s)*u;f.push(e(h,m,o,u))}var p=0,g=Date.now(),y=!1;return r.update=function(){var t=Date.now();if((t-g)/1e3>=1/c&&!y){g=Date.now();var e=++p>=f.length;e&&l?p=0:e&&(p=f.length-1,y=!0)}},r.getCurrentFrame=function(){return f[p]},r.reset=function(){p=0,y=!1},t.def&&(n.anim=r),r}var n=this.solid(t),r={UP:-1,RIGHT:1,DOWN:1,LEFT:-1},i=r.DOWN,a=r.RIGHT,o=t?t.imageId:null,s=A.getImage(o).width;A.getImage(o).height;n.animations={};for(var u in t.animations){var l=t.animations[u];n.animations[l.name]=e(l)}return n.setAnim=function(t){n.anim=n.animations[t]},n.getAnimId=function(){return n.anim.name},n.addAnim=function(t,r){n.animations[t]=e(r),r.def&&(n.anim=n.animations[t])},n.updateAnim=function(){n.anim.update()},n.resetAnim=function(t){t?n.animation[t].reset():n.anim.reset()},n.getDraw=function(){var t=n.anim.getCurrentFrame();return{type:"sprite",frame:t,x:this.x,y:this.y,w:this.w,h:this.h,imageId:o}},n.moveUp=function(){i=r.UP,this.y-=this.spd},n.moveRight=function(){a=r.RIGHT,this.x+=this.spd},n.moveDown=function(){i=r.DOWN,this.y+=this.spd},n.moveLeft=function(){a=r.LEFT,this.x-=this.spd},n.collide=function(){switch(i){case r.UP:this.y+=this.spd,i=0;break;case r.DOWN:this.y-=this.spd,i=0}switch(a){case r.RIGHT:this.x-=this.spd,a=0;break;case r.LEFT:this.x+=this.spd,a=0}},n},tile:function(t){var t=t?t:{},e=this.sprite(t);return e.setAnim("tile"),e.tileId=t.tileId,e},map:function(t){t=t?t:{};var e=this.solid(t),r={};e.layers={};var i=t.tileW,a=t.tileH,o=t.imageId;return e.configureTile=function(t,e){r[t]=e},e.makeTiles=function(){for(var s in t.layers){var u={};u.tiles=[];for(var l in t.layers[s].tiles){var c=t.layers[s].tiles[l];r[c.tileId]?r[c.tileId]:function(t){return t};c.imageId=o,c.w=i,c.h=a,c.animations=[{name:"tile",start:c.tileId,stop:c.tileId+1,def:!0}];var f=n.tile(c);u.tiles.push(f)}e.layers[t.layers[s].name]=u}},e.getDraw=function(t){return e.layers[t]?{type:"mapLayer",tiles:e.layers[t].tiles}:!1},e}};return{inst:t,newClass:e}}function a(t,e){return e.id=y,v[t]=v[t]?v[t]:[],v[t].push(e),y++,e}function o(t){var e=t.group;for(var n in v[e])t.id==v[e][n].id&&v[e].splice(n,1)}function s(t){return v[t]?v[t][0]:!1}function u(t){return v[t]}function l(t){return v[t]?v[t][0]:!1}function c(){function t(t){var e=t.color?t.color:"#0f0";m.fillStyle=e;var n=t.x,r=t.y,i=t.w,a=t.h;m.fillRect(n,r,i,a)}function e(t){var e=A.getImage(t.imageId),n=t.frame,r=n.sx,i=n.sy,a=n.sw,o=n.sh,s=t.x,u=t.y,l=t.w,c=t.h;e&&m.drawImage(e,r,i,a,o,s,u,l,c)}var n={renderMapLayer:function(t,n){var r=l(t);if(r){var i=r.getDraw(n);if(i)for(var a in i.tiles)e(i.tiles[a].getDraw())}},renderGroup:function(n){var r=u(n);for(var i in r){var a=r[i],o=a.getDraw();switch(o.type){case"rect":t(o);break;case"sprite":e(o)}}},fillScreen:function(t,e){m.fillStyle=t?t:"#f0f",m.globalAlpha=e?e:1,m.fillRect(0,0,h.width,h.height)}};return n}function f(t,e,n,r){var i=e,a={stateName:t,init:i,update:n,render:r};x[t]=a,void 0==w&&(w=a)}function d(t){w=x[t]}var h,m,p,g,y=0,v={},_={},x={},w=null,T=window,b=T.requestAnimationFrame||T.mozRequestAnimationFrame||T.msRequestAnimationFrame||T.webkitRequestAnimationFrame||T.oRequestAnimationFrame,A=r(),D=i(),O=c(),E={init:t,begin:e,Entity:D,Asset:A,addEntity:a,removeEntity:o,addState:f,changeState:d,getGroup:u,getMap:l,getFirst:s};return E}var jas=jasFactory();